<?php
// Database Connection
$servername = "localhost";
$username = "root";  // Change as needed
$password = "";  // Change as needed
$dbname = "user_auth";

$conn = new mysqli($servername, $username, $password, $dbname);

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

session_start();

$message = ""; // Message placeholder

// Verify Email and Ask Security Question
if (isset($_POST['verify_email'])) {
    $email = $_POST['email'];
    $stmt = $conn->prepare("SELECT security_question FROM users WHERE email = ?");
    $stmt->bind_param("s", $email);
    $stmt->execute();
    $stmt->store_result();
    
    if ($stmt->num_rows > 0) {
        $stmt->bind_result($security_question);
        $stmt->fetch();
        $_SESSION['reset_email'] = $email;
        $_SESSION['security_question'] = $security_question;
        header("Location: security_question.html");
        exit();
    } else {
        $message = "Email not found.";
    }
    
    $stmt->close();
}

$conn->close();
?>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log In</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="icon.png">
</head>

<body>
  <div class="maincontent">
    <div class="header log">
      <div class="header1"><img class="logo" src="logo.png" alt=""></div>
      <!-- <div class="header2">
                <div class="link"><a href="home.html">Home</a></div>
                <div class="link"><a href="datastream.html">Data Stream</a></div>
                <div class="link"><a href="aboutus.html">About Us</a></div>
                <div class="link"><a href="contactus.html">Contact Us</a></div>
            </div> -->
      <div class="header3">
        <!-- <p>Don't have an account?</p>
                <a href="signup.html"><button>Sign Up</button></a> -->
      </div>
      <!-- <div class="container">
              <div class="burger-menu"><ion-icon name="menu-sharp"></ion-icon></div>
              <nav id="nav-menu">
                  <a href="home.html">Home</a>
                  <a href="datastream.html">DataStream</a>
                  <a href="aboutus.html">About Us</a>
                  <a href="contactus.html">Contact Us</a>
              </nav>
          </div> -->
    </div>

    <form method="post">
      <div class="form">
        <div class="tag">
          <h2>
            <center>Forgot Password</center>
          </h2>
        </div>
        <div class="inputs">
          <input style="width: 300px; padding: 7px; outline: none;" type="email" name="email"
            placeholder="Email Address" required />
        </div>
        <center><p style="color: grey;"> <?php echo $message; ?> </p></center>
        <div class="login">
          <button type="submit" name="verify_email">Verify</button><br>
          <p><a style="color: grey;" href="login.html">Go Back</a>
          </p>
        </div>
      </div>
    </form><br>

  </div>


  <script>
    const burgerMenu = document.querySelector('.burger-menu');
    const navMenu = document.getElementById('nav-menu');

    burgerMenu.addEventListener('click', () => {
      navMenu.style.display = navMenu.style.display === 'block' ? 'none' : 'block';
    });
  </script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

</html>