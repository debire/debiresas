<?php
// Database Connection
$servername = "localhost";
$username = "root";  // Change as needed
$password = "";  // Change as needed
$dbname = "user_auth";

$conn = new mysqli($servername, $username, $password, $dbname);

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Security Questions List
$security_questions = [
    "What is your mother's maiden name?",
    "What was the name of your first pet?",
    "What was the make of your first car?",
    "In what city were you born?",
    "What is your favorite book?"
];

// User Registration
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $email = $_POST['email'];
    $password = password_hash($_POST['password'], PASSWORD_BCRYPT);
    $security_question = $_POST['security_question'];
    $security_answer = password_hash($_POST['security_answer'], PASSWORD_BCRYPT);

    $stmt = $conn->prepare("INSERT INTO users (email, password, security_question, security_answer) VALUES (?, ?, ?, ?)");
    $stmt->bind_param("ssss", $email, $password, $security_question, $security_answer);

    if ($stmt->execute()) {
        header("Location: login.html");
        exit();
    } else {
        echo "Error: " . $stmt->error;
    }

    $stmt->close();
}

$conn->close();
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icon.png">
</head>

<body>
    <div class="maincontent">
        <div class="header log">
            <div class="header1"><img class="logo" src="logo.png" alt=""></div>
            <!-- <div class="header2">
                <div class="link"><a href="home.html">Home</a></div>
                <div class="link"><a href="datastream.html">Data Stream</a></div>
                <div class="link"><a href="aboutus.html">About Us</a></div>
                <div class="link"><a href="contactus.html">Contact Us</a></div>
            </div> -->
            <div class="header3">
                <!-- <p>Don't have an account?</p>
                <a href="signup.html"><button>Sign Up</button></a> -->
            </div>
            <!-- <div class="container">
                <div class="burger-menu"><ion-icon name="menu-sharp"></ion-icon></div>
                <nav id="nav-menu">
                    <a href="home.html">Home</a>
                    <a href="datastream.html">DataStream</a>
                    <a href="aboutus.html">About Us</a>
                    <a href="contactus.html">Contact Us</a>
                </nav>
            </div> -->
        </div>

        <form method="post">
            <div class="form" id="registrationForm">
                <div class="tag">
                    <h2>
                        <center>Sign Up</center>
                    </h2>
                </div>
                <div class="inputs">
                    <h4>
                        <center>Welcome to AgroTech</center>
                    </h4>
                        <input style="width: 100%; padding: 7px; outline: none;" type="email" name="email" placeholder="Email Address" required/>
                    <input style="width: 100%; padding: 7px; outline: none;" type="password" name="password"
                        placeholder="Password" required/>
    
                        <select name="security_question" required>
                            <?php foreach ($security_questions as $question) { ?>
                                <option value="<?php echo $question; ?>"><?php echo $question; ?></option>
                            <?php } ?>
                        </select>
                        <input placeholder="Answer" type="text" name="security_answer" required>
                </div>
                <div class="login">
                    <a href="home.html"><button type="submit">Sign Up</button></a><br>
                    <p class="footertext">
                        Already have an account? <a style="color: grey;" href="login.html">Log In</a>
                    </p>
                </div>
            </div>
        </form>
        <!-- <div class="google">
            <div class="img"><ion-icon name="logo-google"></ion-icon></div>
            <div class="text">Log in with Google</div>
        </div><br><br> -->


    </div>


    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>
        const burgerMenu = document.querySelector('.burger-menu');
        const navMenu = document.getElementById('nav-menu');

        burgerMenu.addEventListener('click', () => {
            navMenu.style.display = navMenu.style.display === 'block' ? 'none' : 'block';
        });
    </script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

</html>